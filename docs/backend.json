{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Artify AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "PromptHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prompt History",
      "type": "object",
      "description": "Represents a single history item of generated prompts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the history entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who generated this prompt."
        },
        "topic": {
          "type": "string",
          "description": "The topic or niche for the generated prompts."
        },
        "number": {
          "type": "number",
          "description": "The number of prompts that were generated."
        },
        "unique": {
            "type": "boolean",
            "description": "Whether the 'unique' option was enabled for this generation."
        },
        "prompts": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "The array of generated prompt strings."
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time when the prompt was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "topic",
        "number",
        "prompts",
        "createdAt",
        "unique"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data. Path-based ownership, ensuring only the authenticated user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user.  Corresponds to `request.auth.uid`."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/prompts/{promptId}",
        "definition": {
          "entityName": "PromptHistory",
          "schema": {
            "$ref": "#/backend/entities/PromptHistory"
          },
          "description": "Stores prompts generated by a specific user. Path-based ownership allows straightforward security rules ensuring only the user can access their prompts.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the prompt.  Corresponds to `request.auth.uid`."
            },
            {
              "name": "promptId",
              "description": "The unique identifier of the prompt."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure secure access and efficient data management for the Artify AI application. The core principle is Authorization Independence, achieved through path-based ownership for user-generated prompts. This eliminates the need for complex `get()` calls in security rules, making them simpler and more robust.  The structure uses hierarchical paths for user-owned data (Prompts), following the pattern `/users/{userId}/prompts/{promptId}`. This clearly defines ownership and enables straightforward security rules based on the user's ID.  This structure directly supports the QAPs by segregating user data, providing clear ownership, and enabling secure list operations within each user's prompt collection."
  }
}
